
<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Social Driving</title>
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v5.12.1/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css2?family=Dosis:wght@300;500;700&display=swap" rel="stylesheet"> 
        <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
        <!-- Favicon -->
        <link rel="icon" type="image/png" href="assets/static/uoft_vert.jpg" />
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-183867332-1"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-183867332-1');
        </script>
    </head>

    <body>

        <!-- header -->
        <div class='jumbotron'>
            <div class="container">
                <h1 class="text-center">Emergent Road Rules in Multi-Agent Driving Environments</h1>
                <br>
                <div class="row text-center">
                    <div class="col-lg-3">
                        <a href="https://avik-pal.github.io" style="font-size: 18px; color: blue;">Avik Pal</a><sup> 1</sup>
                    </div>
                    <div class="col-lg-3">
                        <a href="https://scholar.google.com/citations?user=VVIAoY0AAAAJ&hl=en" style="font-size: 18px; color: blue;">Jonah Philion</a><sup> 2,3,4</sup>
                    </div>
                    <div class="col-lg-3">
                        <a href="https://andrewliao11.github.io/" style="font-size: 18px; color: blue;">Andrew Liao</a><sup> 3,4</sup>
                    </div>
                    <div class="col-lg-3">
                        <a href="https://www.cs.utoronto.ca/~fidler/" style="font-size: 18px; color: blue;">Sanja Fidler</a><sup> 2,3,4</sup>
                    </div>
                </div>
                <br/>
                <div class="row text-center">
                    <div class="col-lg-3">
                        IIT Kanpur<sup>1</sup>
                    </div>
                    <div class="col-lg-3">
                        NVIDIA<sup>2</sup>
                    </div>
                    <div class="col-lg-3">
                        University of Toronto<sup>3</sup>
                    </div>
                    <div class="col-lg-3">
                        Vector Institute<sup>4</sup>
                    </div>
                </div>
                <br/>
                <!-- <div class="row text-center">
                    <div class="col-sm-12">
                        <b>NeurIPS Workshop on Deep Reinforcement Learning 2020</b>
                    </div>
                </div> -->
                <br>
                <div class="col-md-12 text-center">
                    <img class="img-fluid" src="assets/banner.gif"></img>
                </div>
                <!-- <div class="row text-center">
                    <div class="col-sm-12">
                        Under Review at ICLR 2021
                    </div>
                </div> -->
            </div>
        </div>
    
        <div class="container">
            <!-- <h2 class="text-center">Abstract</h2> -->
            <p class="text-justify">
                For autonomous vehicles to safely share the road with human drivers, autonomous vehicles must abide by specific "road rules" that human drivers have agreed to follow. "Road rules" include rules that drivers are required to follow by law – such as the requirement that vehicles stop at red lights – as well as more subtle social rules – such as the implicit designation of fast lanes on the highway. In this paper, we provide empirical evidence that suggests that – instead of hard-coding road rules into self-driving algorithms – a scalable alternative may be to design multi-agent environments in which road rules emerge as optimal solutions to the problem of maximizing traffic flow.  We analyze what ingredients in driving environments cause the emergence of these road rules and find that two crucial factors are noisy perception and agents’ spatial density.  We provide qualitative and quantitative evidence of the emergence of seven social driving behaviors, ranging from obeying traffic signals to following lanes, all of which emerge from training agents to drive quickly to destinations without colliding. Our results add empirical support for the social road rules that countries worldwide have agreed on for safe, efficient driving.
            </p>

            <hr>

            <span class="border border-white">
                <h2 class="text-center">Paper</h2>
                <br>
                <div class='row'>
                    <div class='col'>
                        <a href="" target='_blank'><img src='paper.png' class='img-fluid float-right' style='height:180px; border: solid; border-radius:30px; border-color:#000000;'></a>
                    </div>
                    <div class='col'>
                        <p class="card-text">Avik Pal, Jonah Philion, Andrew Liao, Sanja Fidler</p>
                        <p class="card-text">Emergent Road Rules in Multi-Agent Driving Environments</p>
                        <p class="card-text">NeurIPS DeepRL, 2020.</p>
                        <p class="card-text">
                            <a href="https://arxiv.org/abs/2011.10753">[Preprint]</a>&emsp;
                            <a href="https://github.com/fidler-lab/social-driving">[Code]</a>&emsp;
                            <a href="bibtex.bib">[Bibtex]</a>&emsp;
                        </p>
                    </div>
                </div>
            </span>
          
            <hr/>

            <span class="border border-white">
                <h2 class="text-center">Overview</h2>
                <br>
                <p class="large text-justify">
                    Our main contributions in this paper are:
                    <ul class="large text-justify">
                        <li>
                            We define a multi-agent driving environment in which agents equipped with noisy LiDAR sensors are rewarded for reaching a given destination as quickly as possible without colliding with other agents and show that agents trained in this environment learn road rules thatmimic road rules common in human driving systems.
                        </li>
                        <li>
                            We analyze what choices in the definition of the MDP lead to the emergence of these roadrules and find that the most important factors are perception noise and the spatial density ofagents in the driving environment.
                        </li>
                        <li>
                            We release a suite of 2D driving environments with the intention of stimulating interest within the MARL community to solve fundamental self-driving problems
                        </li>
                    </ul>
                </p>
            </span>

            <hr>

            <br>

            <h2 class="text-center">Emergent Social Driving Rules</h2>
            <span class="border border-white">
                <h4 class="text-left">1. Stopping at a Traffic Signal</h4>
                <br>

                <div class="row">
                    <div class="col-md-12 text-justify">
                        In a 4-way intersection, agents learn to obey traffic signals to safely navigate to the opposite road in minimum time.
    
                        Note that the agents merely observe a ternary value representing the traffic light’s state, not color. To make the visualizations, we visually inspect rollouts for each converged policy to find a permutation of the ternary states that align with human red/yellow/green traffic light conventions
                    </div>
                </div>
                
                <br><br>

                <div class="row">
                    <div class="col-md-3">
                        <h6 class="text-center">Lidar Noise = 0%</h6>
                    </div>
                    <div class="col-md-3">
                        <h6 class="text-center">Lidar Noise = 25%</h6>
                    </div>
                    <div class="col-md-3">
                        <h6 class="text-center">Lidar Noise = 50%</h6>
                    </div>
                    <div class="col-md-3">
                        <h6 class="text-center">Lidar Noise = 75%</h6>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-3">
                        <img class="img-fluid" src="assets/ts000_1.gif"></img>
                    </div>
                    <div class="col-md-3">
                        <img class="img-fluid" src="assets/ts025_1.gif"></img>
                    </div>
                    <div class="col-md-3">
                        <img class="img-fluid" src="assets/ts050_1.gif"></img>
                    </div>
                    <div class="col-md-3">
                        <img class="img-fluid" src="assets/ts075_1.gif"></img>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-3">
                        <img class="img-fluid" src="assets/ts000_2.gif"></img>
                    </div>
                    <div class="col-md-3">
                        <img class="img-fluid" src="assets/ts025_2.gif"></img>
                    </div>
                    <div class="col-md-3">
                        <img class="img-fluid" src="assets/ts050_2.gif"></img>
                    </div>
                    <div class="col-md-3">
                        <img class="img-fluid" src="assets/ts075_2.gif"></img>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-3">
                        <img class="img-fluid" src="assets/ts000_3.gif"></img>
                    </div>
                    <div class="col-md-3">
                        <img class="img-fluid" src="assets/ts025_3.gif"></img>
                    </div>
                    <div class="col-md-3">
                        <img class="img-fluid" src="assets/ts050_3.gif"></img>
                    </div>
                    <div class="col-md-3">
                        <img class="img-fluid" src="assets/ts075_3.gif"></img>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-3">
                        <img class="img-fluid" src="assets/ts000_4.gif"></img>
                    </div>
                    <div class="col-md-3">
                        <img class="img-fluid" src="assets/ts025_4.gif"></img>
                    </div>
                    <div class="col-md-3">
                        <img class="img-fluid" src="assets/ts050_4.gif"></img>
                    </div>
                    <div class="col-md-3">
                        <img class="img-fluid" src="assets/ts075_4.gif"></img>
                    </div>
                </div>
                
                <br>
                <h5 class="text-left">Transfer from Synthetic Map to a Real World Map</h5>
                <br>

                In this experiment we show that policies trained on the synthetic intersection above transfer to real-world intersections found in the nuScenes dataset.
                <br><br>
                <div class="row center">
                    <div class="col-md-6">
                        <img class="img-fluid" src="assets/r1_gen.gif"></img>
                    </div>
                    <div class="col-md-6">
                        <img class="img-fluid" src="assets/r2_gen.gif"></img>
                    </div>
                </div>
            </span>

            <hr>

            <span class="border border-white">
                <h4 class="text-left">2. Emergence of Lanes</h4>
                <br>

                When the agents are trained in an environment contraining 4 agents they follow a consistent lane till the time they cross the intersection. This is a consequence of the starting configuration which prevents agents from colliding with other agents after having crossed the intersection.

                <br><br>

                <div class="row">
                    <div class="col-md-4">
                        <h6 class="text-center">Lidar Noise = 25%</h6>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-center">Lidar Noise = 50%</h6>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-center">Lidar Noise = 75%</h6>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <img class="img-fluid" src="assets/le4_025_1.gif"></img>
                    </div>
                    <div class="col-md-4">
                        <img class="img-fluid" src="assets/le4_050_1.gif"></img>
                    </div>
                    <div class="col-md-4">
                        <img class="img-fluid" src="assets/le4_075_1.gif"></img>
                    </div>
                </div>
                <br><br>
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-center">Lidar Noise = 0%</h6>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-center">Lidar Noise = 100%</h6>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <img class="img-fluid" src="assets/le4_2.gif"></img>
                    </div>
                    <div class="col-md-6">
                        <img class="img-fluid" src="assets/le4_100_1.gif"></img>
                    </div>
                </div>

                <br>
                When the number of agents during training are increased, the agents tend to follow the lanes consistently till they reach their destination. Additionally in case of 8 agents, we see the formation of multi-lane tracks. Qualitatively we can see that agents starting from the left side of the road tend to take the lane closer to the center and the ones starting on the right side take the extreme right lane. This additionally allows a smoother traffic flow.
                <br>
                <br>
                <div class="row">
                    <div class="col-md-4">
                        <h6 class="text-center">Number of Training Agents = 4</h6>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-center">Number of Training Agents = 8</h6>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-center">Number of Training Agents = 8</h6>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <img class="img-fluid" src="assets/le4_2.gif"></img>
                    </div>
                    <div class="col-md-4">
                        <img class="img-fluid" src="assets/le8_1.gif"></img>
                    </div>
                    <div class="col-md-4">
                        <img class="img-fluid" src="assets/le8_2.gif"></img>
                    </div>
                </div>

                <br>

                Spatial Locations of the Agents when trained on 8 agent environment

                <br><br>

                <div class="col-md-6 offset-md-3 justify-content-center">
                    <img class="img-fluid" src="assets/8agents_lanepos.gif"></img>
                </div>
            </span>

            <hr>

            <span class="border border-white">
                <h4 class="text-left">3. Fast Lanes on a Highway</h4>

                <br>
                We observe that depending on how fast the agents are they choose to travel along the left hand side or right hand side of the road. This is similar to fast lanes which are present on the highways. (Darker shades denote faster cars)

                <br>
                <br>

                <div class="col-md-12">
                    <img class="img-fluid" src="assets/fastlanes.gif"></img>
                </div>

                <div class="col-md-12">
                    <img class="img-fluid" src="assets/hway1.gif"></img>
                </div>

                <div class="col-md-12">
                    <img class="img-fluid" src="assets/hway2.gif"></img>
                </div>
            </span>

            <hr>

            <span class="border border-white">
                <h4 class="text-left">4. Stopping at a Crosswalk</h4>

                <br>
                The agents detect the pedestrians (small green boxes) walking along the crosswalk, and slow down once they approach the crosswalk.
                <br>

                <div class="row">
                    <div class="col-md-12">
                        <img class="img-fluid" src="assets/ped1.gif"></img>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <img class="img-fluid" src="assets/ped2.gif"></img>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <img class="img-fluid" src="assets/ped3.gif"></img>
                    </div>
                </div>
            </span>

            <hr>

            <span class="border border-white">
                <h4 class="text-left">5. Communication</h4>

                <br>
                We denote the signals sent by the agents with the colors of the agents. In the left video where there is no perception noise, the agents' signals are not correlated with their actions/heading. In the right hand side video, we do see that agents that turn right, tend to be colored black while the ones turning right are colored red.
                <br><br>
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-center">Lidar Noise = 0%</h6>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-center">Lidar Noise = 100%</h6>
                    </div>
                </div>
                <!-- <br> -->

                <div class="row">
                    <div class="col-md-6 embed-responsive embed-responsive-1by1">
                        <video class="embed-responsive-item" src="./assets/nuscenes_comm_1.mp4" allowfullscreen controls></video>
                    </div>
                    <div class="col-md-6 embed-responsive embed-responsive-1by1">
                        <video class="embed-responsive-item" src="./assets/nuscenes_comm_2.mp4" allowfullscreen controls></video>
                    </div>
                </div>
            </span>

            <hr>

            <span class="border border-white">
                <h4 class="text-left">6. Rollouts on nuScenes</h4>
                <br>
                In these experiments, we attempt to show that agents learn to maintain a minimum distance between themselves as a function of their relative velocity. Additionally we observe the emergence of right of way where the agent which arrives first at the intersection gets to leave it first.
                <br>
                <br>

                <div class="row">
                    <div class="col-md-4">
                        <img class="img-fluid" src="assets/r1.gif"></img>
                    </div>
                    <div class="col-md-4">
                        <img class="img-fluid" src="assets/r2.gif"></img>
                    </div>
                    <div class="col-md-4">
                        <img class="img-fluid" src="assets/r7.gif"></img>
                    </div>
                </div>

                <!-- <br>
                Rollouts from more nuScenes Intersections
                <br><br> -->
                <br>

                <div class="row">
                    <div class="col-md-4">
                        <img class="img-fluid" src="assets/r8.gif"></img>
                    </div>
                    <div class="col-md-4">
                        <img class="img-fluid" src="assets/r4.gif"></img>
                    </div>
                    <div class="col-md-4">
                        <img class="img-fluid" src="assets/r5.gif"></img>
                    </div>
                </div>
                <br>

                <div class="row">
                    <div class="col-md-4">
                        <img class="img-fluid" src="assets/r9.gif"></img>
                    </div>
                    <div class="col-md-4">
                        <img class="img-fluid" src="assets/r10.gif"></img>
                    </div>
                    <div class="col-md-4">
                        <img class="img-fluid" src="assets/r6.gif"></img>
                    </div>
                </div>

                <!-- <div class="row">
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <img class="img-fluid" src="assets/r1_gen.gif"></img>
                    </div>
                    <div class="col-md-6">
                        <img class="img-fluid" src="assets/r2_gen.gif"></img>
                    </div>
                </div> -->
            </span>

            <!-- <br><br>

            <h2 class="text-center">Episode Return over Time</h2>

            <br><br>

            <h4 class="text-left">Obeying Traffic Signal</h4>

            <br>

            Episode Return over time for the Toy Intersection with 4 agents.

            <br><br>

            <div class="col-md-6">
                <img class="img-fluid" src="assets/episode-return.png"></img>
            </div> -->

            <!-- <br><br> -->

            <hr>
            <!-- <br><br> -->
        </div>

        <!-- Footer-->
        <footer class="footer py-4">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-12 text-center">
                        <img src="assets/static/uoft.png" style="width: 15%;"></img>
                        <img src="assets/static/vector.jpg" style="width: 15%;"></img>
                        <br>
                        <p class="copyright text-center"> Copyright &copy; University of Toronto 2020</p>
                    </div>
                </div>
            </div>
        </footer>
        
        <!-- Bootstrap core JS-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
        <!-- Third party plugin JS-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    </body>
</html>
